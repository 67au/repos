# Maintainer: KunoiSayami <i@leanhe.dev>

_original_name=teamspeak-autochannel
_basename=teamspeak-autochannel
pkgname=ksutils-$_basename
pkgver=0.7.0
pkgrel=1
pkgdesc='TeamSpeak auto channel rust implement'
arch=('any')
url=https://github.com/KunoiSayami/teamspeak-autochannel.rs
source=(
    $pkgname::git+https://github.com/KunoiSayami/teamspeak-autochannel.rs#tag=v$pkgver
    "$pkgname@.service"
    "default.toml"
)
license=('AGPL3')
sha512sums=(
    'SKIP'
    'fea25058b0fcee166d953cbf74da8f06965634ee1276b6896d1c3d728df5fb94d0a9324849c90c9bb3c69863d8693c6fa2998d01d42eb0f886bc98ec65054a42'
    'bde6a26a4060525cadcc34245f2ebb4a86f0bbda4527d15e4f30f012975e48a468f47fc2cf9b1d237b12459cbec631908fcb9577fd9c3e91fb0546ad08f4c0b4'
)
makedepends=('cargo' 'git')
depends=('redis')
provides=("$_basename")
options=(!lto)
backup=("etc/ksutils/$_basename/default.toml")

prepare() {
    cd "$pkgname"
    git submodule update --init
}

build() {
    cd "$pkgname"
    cargo build --release
}

package() {
    install -dm700 "$pkgdir"/etc/ksutils/$_basename
    install -dm755 "$pkgdir"/usr/bin
    install -dm755 "$pkgdir"/usr/lib/systemd/system

    install -m755 "$pkgname"/target/release/"$_original_name" "$pkgdir"/usr/bin/"$pkgname"
    install -m600 default.toml "$pkgdir"/etc/ksutils/$_basename/
    install -m644 "$pkgname@.service" "$pkgdir"/usr/lib/systemd/system/
}
